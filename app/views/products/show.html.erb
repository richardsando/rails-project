
<% if notice == 'The item has been successfully added to your cart.' %>
  <div class="message-wrap">
    <%= inline_svg("_ionicons_svg_md-checkmark-circle.svg", class: "check-icon") %>
    <p id="item-added-notice"><%= notice %></p>    <%# need to have a notice that pops up saying that the item was successfully added %>
    
    <% if current_user != nil %>
      <% if current_user.profile != nil %>
      
        <p> <%= link_to 'To cart.', "/profiles/#{current_user.profile.id}/showcart" %> </p>
        <%= link_to inline_svg("_ionicons_svg_md-close.svg", class: "exit-icon"), "/products/#{@product.id}", class: 'exit-link' %>

      <% end %>
    <% end %>
  </div>

<% elsif notice == 'Sorry, you have ordered more items than there are in stock.' %>
  <div class="message-wrap">
    <p id="qty-exceeded-notice"><%= notice %></p> 
    <%= link_to inline_svg("_ionicons_svg_md-close.svg", class: "exit-icon"), "/products/#{@product.id}", class: 'exit-link' %>
  </div>
  
<% end %>

<p>
  <strong>Name:</strong>
  <%= @product.name %>
</p>

<p>
  <strong>Description:</strong>
  <%= @product.description %>
</p>


<p>
  <strong>Artist:</strong>
  <%= link_to @product.profile.username, @product.profile  %>
</p>

<p>
<strong>Category:</strong>
<%= 
if @product.category.category == "T-shirts"
  link_to @product.category.category, '/tshirts'
elsif @product.category.category == "Stickers"
  link_to @product.category.category, '/stickers'
elsif @product.category.category == "iPhone cases"
  link_to @product.category.category, '/iphonecases'
else @product.category.category == "Prints"
  link_to @product.category.category, '/prints'
end
%>
</p>

<% if current_user.profile != @product.profile %>
  <%= form_with(url: "/profiles/#{current_user.profile.id}/addproducttocart", local: true) do |form| %>

    <% possible_sizes = [] %>
    <% @product.product_variants.each do |variant| %>
      <% possible_sizes << variant.size_id %>
    <% end %>

    <div class="field" >
        <%= form.label :size %>
        <%= form.collection_select :size_id, Size.where(category: @product.category.category).where(id: possible_sizes), :id, :sizing %>
    </div>

    <div class="field">
      <%= form.label :qty %>
      <%= form.number_field :qty, min: 1, max: 12 %>
    </div>

    <div class="field">
      <%= form.hidden_field :product_id, value: (@product.id) %>
    </div>
    <div class="actions">
      <%= form.submit "Add to cart"%>
    </div>
  <% end %>
<% end %>

<p>
<strong>Fandom:</strong>
<%= @product.fandom.fandom %>
</p>

<% if @product.uploaded_image.attached? %>
  <%# @product.uploaded_image.each do |image| %>
      <div id="artist-product-img">
          <%= image_tag @product.uploaded_image.service_url, class: 'image-size' %>
      </div>
  <%# end %>    
<% else %>
  <p>No image for this product</p>
<% end %>

<br>
<% if user_signed_in? %>
<% if current_user.profile != nil %>
  <% if current_user.profile != @product.profile %>
      <%= link_to 'add to cart', "/profiles/#{current_user.profile.id}/addtocart?product_id=#{@product.id}" %> |

      
      <%#= link_to 'add to wishlist', "/profiles/#{current_user.profile.id}/addtowishlist?product_id=#{@product.id}" %> 
      <div class="wishlist-box">
        <% if current_user.profile.wishlist.products.where("product_id = ?", @product.id).present? %>
          <%# the current product that the user is on has already been added to the wishlist %>
          <%= link_to inline_svg("_ionicons_svg_md-star.svg", class: "wishlist-icon-active"), "/profiles/#{current_user.profile.id}/show-wishlist/remove-item?product_id=#{@product.id}" %>
        <% else %>
          <%= link_to inline_svg("_ionicons_svg_md-star.svg", class: "wishlist-icon-inactive"), "/profiles/#{current_user.profile.id}/addtowishlist?product_id=#{@product.id}" %>
        <% end %>
      </div>

      <%#= link_to 'Back', products_path %>

  <% end %>

  <% if current_user.profile == @product.profile %>
        <%= link_to 'Delete', "/products/#{@product.id}", method: :delete %> |
        <%= link_to 'Edit', edit_product_path(@product) %> |
        <%= link_to 'back to profile', "/profiles/#{@product.profile.id}" %>
  <% end %>
  <% end %>



<% else %>  <%#user needs to be signed in in order to add the product to their cart or their wishlist %>
  <%= link_to 'Add to cart', "/users/sign_in", data: { confirm: 'You must log in to add to cart, are you sure?' } %>
  <%= link_to 'Add to wishlist', "/users/sign_in", data: { confirm: 'You must log in to add to wishlist, are you sure?' }%>

<% end %>


<% if current_user.profile == @product.profile %>

<br><br><br>

<%= link_to "Add a #{@product.name} variant", "/products/#{params[:id]}/add-variant" %>
<br><br>

<h3>Current stock in your store </h3>
  <table>
    <thead>
      <tr>
        <th>Size</th>
        <th>SKU</th>
        <th>Price ($AUD)</th>
        <th colspan="3"></th>
      </tr>
    </thead>

    <tbody>
      <% @product.product_variants.each do |variant| %>
        <tr>
          <td><%= variant.size.sizing %>  </td>
          <td><%= variant.stock_QTY %></td>
          <td><%= variant.price  %></td> 
          <td><%= link_to 'Edit', "/products/#{params[:id]}/edit-variant/#{variant.id}" %></td>
          <td><%= link_to 'Delete', "/products/#{params[:id]}/remove-variant/#{variant.id}" %></td>
        </tr>
      <% end %>
    </tbody>

  </table>
<% end %>




